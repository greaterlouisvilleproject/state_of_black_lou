---
title: "State of Black Louisville"
output: html_notebook
---

```{r "setup", include=FALSE}
require("knitr")
opts_knit$set(root.dir = "C:/Users/Harrison Kirby/Desktop/GLP/state_of_black_lou")
```

Load libraries
```{r, message = FALSE}
#State of Black Louisville Analysis

library(dplyr)
library(reshape2)
library(ggplot2)
library(ggthemes)
library(showtext)
library(grid)
library(scales)
```

Add fonts and create directories
```{r, message = FALSE}
font.add("Museo Sans 300", "C:/Users/Harrison Kirby/Desktop/GLP/MuseoSans_300.otf")
font.add("Museo Sans Italic", "C:/Users/Harrison Kirby/Desktop/GLP/MuseoSans_300_Italic.otf")

if(!dir.exists("Images September 2017")){
  dir.create("Images September 2017")
}
```

Helper functions
```{r, message = FALSE}
acs_time<-function(directory,starting.year=2005){
  setwd(directory)
  file_names<-list.files()
  n<-length(file_names)
  y<-starting.year
  for (i in 1:n){
    data<-read.csv(file_names[i],header=TRUE, skip=1)
    names(data)[names(data) == 'Id2'] <- 'FIPS'
    all.peers <-subset(data, data$FIPS == 1073 |data$FIPS == 37119
                       |data$FIPS == 39061 |data$FIPS == 39049
                       |data$FIPS == 26081 |data$FIPS == 37081
                       |data$FIPS == 45045 |data$FIPS == 18097
                       |data$FIPS == 29095 |data$FIPS == 47093
                       |data$FIPS == 21111 |data$FIPS == 47157
                       |data$FIPS == 47037 |data$FIPS == 40109
                       |data$FIPS == 31055 |data$FIPS == 29189
                       |data$FIPS == 29510
                       |data$FIPS == 40143 |data$FIPS == 39113
                       |data$FIPS == 12031 |data$FIPS == 37183
                       |data$FIPS == 37183 |data$FIPS == 51760)
    
    all.peers$year<-y
    all.peers$baseline<-1
    all.peers$current<-1
    all.peers$baseline[all.peers$FIPS==26081|all.peers$FIPS==29189
                       |all.peers$FIPS==29510|all.peers$FIPS==40109
                       |all.peers$FIPS==40143|all.peers$FIPS==45045
                       |all.peers$FIPS==47093]<-0
    all.peers$current[all.peers$FIPS== 12031|all.peers$FIPS==37183|
                        all.peers$FIPS==39113|all.peers$FIPS==51760]<-0
    y<-y+1
    
    if(i==1){
      df<-all.peers 
    }
    else{
      names(all.peers)<-names(df)
      df<-rbind(df, all.peers)
    }
  }
  df
}

stl_wgt<-function(df,var){
  df$var <- df[[var]]
  stl.15<-subset(df, year==2015 & (FIPS==29189|FIPS==29510))
  stl.wgt.15<-weighted.mean(stl.15$var, c(.761,.239))
  
  stl.14<-subset(df, year==2014 & (FIPS==29189|FIPS==29510))
  stl.wgt.14<-weighted.mean(stl.14$var, c(.759,.241))
  
  stl.13<-subset(df, year==2013 & (FIPS==29189|FIPS==29510))
  stl.wgt.13<-weighted.mean(stl.13$var, c(.759,.241))
  
  stl.12<-subset(df, year==2012 & (FIPS==29189|FIPS==29510))
  stl.wgt.12<-weighted.mean(stl.12$var, c(.759,.241))
  
  stl.11<-subset(df, year==2011 & (FIPS==29189|FIPS==29510))
  stl.wgt.11<-weighted.mean(stl.11$var, c(.758,.242))
  
  stl.10<-subset(df, year==2010 & (FIPS==29189|FIPS==29510))
  stl.wgt.10<-weighted.mean(stl.10$var, c(.758,.242))
  
  stl.09<-subset(df, year==2009 & (FIPS==29189|FIPS==29510))
  stl.wgt.09<-weighted.mean(stl.09$var, c(.736,.264))
  
  stl.08<-subset(df, year==2008 & (FIPS==29189|FIPS==29510))
  stl.wgt.08<-weighted.mean(stl.08$var, c(.737,.263))
  
  stl.07<-subset(df, year==2007 & (FIPS==29189|FIPS==29510))
  stl.wgt.07<-weighted.mean(stl.07$var, c(.739,.261))
  
  stl.06<-subset(df, year==2006 & (FIPS==29189|FIPS==29510))
  stl.wgt.06<-weighted.mean(stl.06$var, c(.742,.258))
  
  stl.05<-subset(df, year==2005 & (FIPS==29189|FIPS==29510))
  stl.wgt.05<-weighted.mean(stl.05$var, c(.747,.253))
  
  stl<-c(stl.wgt.15,stl.wgt.14,stl.wgt.13,stl.wgt.12,stl.wgt.11,stl.wgt.10,stl.wgt.09,
         stl.wgt.08,stl.wgt.07,stl.wgt.06,stl.wgt.05)
  year<-2015:2005
  FIPS<-rep(0,11)
  current<-rep(1,11)
  stl.df<-cbind(FIPS,year,stl,current)
  colnames(stl.df)<-c("FIPS","year",var,"current")
  stl.df<-as.data.frame(stl.df)
  stl.df
}
```

Graphing functions
```{r, message = FALSE}
one_var_trend = function(df, 
                         var, 
                         title, 
                         y_title = "Percent",
                         y_lower = 0,
                         y_upper = NA,
                         color = "red",
                         caption_text = ""){
  df$var<-df[[var]]
  p<-ggplot(data=df,aes(x=year,y=var))+
    geom_point(size = 2, colour = color)+
    geom_smooth(colour = color)
  p<-p+theme_bw()
  p<-p+scale_x_continuous(breaks=seq(2005, 2015, 2))
  p<-p+theme(text = element_text(family = "Museo Sans 300"))
    p<-p+labs(title=title,
            x="Year",
            y=y_title,
            caption = caption_text)
  p<-p+theme(legend.title=element_blank())
  p<-p+theme(axis.title=element_text(family = "Museo Sans 300", 
                                     size = 36))

  p<-p+theme(axis.text=element_text(size=36, family = "Museo Sans 300"))
  p<-p+theme(axis.ticks.y=element_blank())
  p<-p+theme(plot.title=element_text(color="black",
                                     size=54,
                                     face="bold",
                                     hjust=.5,
                                     margin=margin(b=10,unit="pt"),
                                     family = "Museo Sans 300"))
  p<-p+theme(legend.text=element_text(size=36, family = "Museo Sans 300"))
  p<-p+theme(plot.caption = element_text(size = 24,
                                         lineheight = .3))
  p<-p + ylim(y_lower, y_upper)
  p
}

two_var_trend = function(df, var1, var2, var1_name, var2_name, 
                         title,
                         y_title="Percent", 
                         colors = c("red", "skyblue3"),
                         y_lower = 0, 
                         y_upper = 30, 
                         caption_text = "",
                         y_lower_se = -50){
  df$var1<-df[[var1]]
  df$var2<-df[[var2]]
  data_keep = df %>%
    select(year, var1, var2)
  data_long<-melt(data_keep, id="year")
  p<-ggplot(data=data_long,
            aes(x=year,y=value, shape=variable, linetype=variable, colour=variable))+
    geom_point(size = 2)+
    geom_smooth(show.legend = FALSE)+
    scale_linetype_manual(values = c(1,5)) +
    scale_shape_manual(values=c(19,15))
  p<-p+theme_bw()
  p<-p+scale_x_continuous(breaks=seq(2005, 2015, 2))
  p<-p+theme(legend.title=element_blank())
  p<-p+scale_shape(labels=c(var1_name, var2_name))
  p<-p+scale_linetype_manual(values=c(1,5), labels=c(var1_name, var2_name))
  p<-p+scale_colour_discrete(labels=c(var1_name, var2_name))
  p<-p+scale_colour_manual(values = colors, labels = c(var1_name, var2_name))
  p<-p+theme(axis.title=element_text(family = "Museo Sans 300"))
  p<-p+labs(title=title,
            x="Year",
            y=y_title, 
            caption = caption_text)
  
  p<-p+theme(axis.text=element_text(size=36, family = "Museo Sans 300"))
  p<-p+theme(axis.title = element_text(size=36))
  p<-p+theme(axis.ticks.y=element_blank())
  p<-p+theme(plot.title=element_text(color="black",
                                     size=54,
                                     face="bold",
                                     hjust=.5,
                                     margin=margin(b=10,unit="pt"), 
                                     family = "Museo Sans 300",
                                     lineheight = .3))
  p<-p+theme(legend.text=element_text(size=36, family = "Museo Sans 300"))+
       guides(linetype=FALSE)
  p<-p+theme(plot.caption = element_text(family = "Museo Sans 300",
                                         size = 24,
                                         lineheight = .3))
  p<-p+theme(plot.margin = unit(c(.5,.25,.1,.5), "cm"))
  p = p + ylim(y_lower_se, y_upper)
  p <- p + coord_cartesian(ylim = c(y_lower, y_upper))
  p <- p + scale_y_continuous(label=comma)
  p
}
```


UNEMPLOYMENT

Read in unemployment data 
```{r, message = FALSE}
#BLACK

black_unemployment_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Unemp Black")

black_unemployment_data = black_unemployment_data %>% 
  mutate(male_unemployed_16_24 = 
           Estimate..Male....16.to.19.years....In.labor.force....Civilian....Unemployed+
           Estimate..Male....20.to.24.years....In.labor.force....Civilian....Unemployed,
         
         male_unemployed = 
           male_unemployed_16_24+
           Estimate..Male....25.to.54.years....In.labor.force....Civilian....Unemployed+
           Estimate..Male....55.to.64.years....In.labor.force....Civilian....Unemployed+
           Estimate..Male....65.to.69.years....In.labor.force....Unemployed+
           Estimate..Male....70.years.and.over....In.labor.force....Unemployed,
         
         male_in_labor_force_16_24 = 
           Estimate..Male....16.to.19.years....In.labor.force.+
           Estimate..Male....20.to.24.years....In.labor.force.,
         
         male_in_labor_force = 
           male_in_labor_force_16_24+
           Estimate..Male....25.to.54.years....In.labor.force.+
           Estimate..Male....55.to.64.years....In.labor.force.+
           Estimate..Male....65.to.69.years....In.labor.force.+
           Estimate..Male....70.years.and.over....In.labor.force.,
         
         male_unemployment = male_unemployed/male_in_labor_force,
         
         male_unemployment_16_24 = male_unemployed_16_24/male_in_labor_force_16_24,
         
         male_out_of_lf_25_54 = 1-(Estimate..Male....25.to.54.years....In.labor.force./Estimate..Male....25.to.54.years.),
         
         female_unemployed_16_24 = 
           Estimate..Female....16.to.19.years....In.labor.force....Civilian....Unemployed+
           Estimate..Female....20.to.24.years....In.labor.force....Civilian....Unemployed,
         
         female_unemployed = 
           female_unemployed_16_24+
           Estimate..Female....25.to.54.years....In.labor.force....Civilian....Unemployed+
           Estimate..Female....55.to.64.years....In.labor.force....Civilian....Unemployed+
           Estimate..Female....65.to.69.years....In.labor.force....Unemployed+
           Estimate..Female....70.years.and.over....In.labor.force....Unemployed,
         
         female_in_labor_force_16_24 = 
           Estimate..Male....16.to.19.years....In.labor.force.+
           Estimate..Female....20.to.24.years....In.labor.force.,
         
         female_in_labor_force = 
           female_in_labor_force_16_24+
           Estimate..Female....25.to.54.years....In.labor.force.+
           Estimate..Female....55.to.64.years....In.labor.force.+
           Estimate..Female....65.to.69.years....In.labor.force.+
           Estimate..Female....70.years.and.over....In.labor.force.,
         
         female_unemployment = female_unemployed/female_in_labor_force,
         
         female_unemployment_16_24 = female_unemployed_16_24/female_in_labor_force_16_24,
         
         female_out_of_lf_25_54 = 1-(Estimate..Female....25.to.54.years....In.labor.force./Estimate..Female....25.to.54.years.),
         
         unemployment = (male_unemployed+female_unemployed)/(male_in_labor_force+female_in_labor_force),
         
         unemployment_16_24 = (male_unemployed_16_24+female_unemployed_16_24)/(male_in_labor_force_16_24+female_in_labor_force_16_24))

lville_black_unemployment = 
  black_unemployment_data %>%
  filter(FIPS == 21111)%>%
  select(year, unemployment, male_unemployment, female_unemployment, male_unemployment_16_24, 
         female_unemployment_16_24, male_out_of_lf_25_54,female_out_of_lf_25_54, unemployment_16_24)%>%
  mutate(bl_unemployment = unemployment*100,
         bl_male_unemployment = male_unemployment*100,
         bl_female_unemployment = female_unemployment*100,
         bl_male_unemployment_16_24 = male_unemployment_16_24*100,
         bl_female_unemployment_16_24 = female_unemployment_16_24*100,
         bl_male_out_of_lf_25_54 = male_out_of_lf_25_54*100,
         bl_female_out_of_lf_25_54 = female_out_of_lf_25_54*100,
         bl_unemployment_16_24 = unemployment_16_24*100)

#WHITE

white_unemployment_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Unemp White")

white_unemployment_data = 
  white_unemployment_data %>% 
  mutate(male_unemployed_16_24 = 
           Estimate..Male....16.to.19.years....In.labor.force....Civilian....Unemployed+
           Estimate..Male....20.to.24.years....In.labor.force....Civilian....Unemployed,
         
         male_unemployed = 
           male_unemployed_16_24+
           Estimate..Male....25.to.54.years....In.labor.force....Civilian....Unemployed+
           Estimate..Male....55.to.64.years....In.labor.force....Civilian....Unemployed+
           Estimate..Male....65.to.69.years....In.labor.force....Unemployed+
           Estimate..Male....70.years.and.over....In.labor.force....Unemployed,
         
         male_in_labor_force_16_24 = 
           Estimate..Male....16.to.19.years....In.labor.force.+
           Estimate..Male....20.to.24.years....In.labor.force.,
         
         male_in_labor_force = male_in_labor_force_16_24+
           Estimate..Male....25.to.54.years....In.labor.force.+
           Estimate..Male....55.to.64.years....In.labor.force.+
           Estimate..Male....65.to.69.years....In.labor.force.+
           Estimate..Male....70.years.and.over....In.labor.force.,
         
         male_unemployment = male_unemployed/male_in_labor_force,
         
         male_unemployment_16_24 = male_unemployed_16_24/male_in_labor_force_16_24,
         
         male_out_of_lf_25_54 = 1-(Estimate..Male....25.to.54.years....In.labor.force./Estimate..Male....25.to.54.years.),
         
         female_unemployed_16_24 = 
           Estimate..Female....16.to.19.years....In.labor.force....Civilian....Unemployed+
           Estimate..Female....20.to.24.years....In.labor.force....Civilian....Unemployed,
         
         female_unemployed = 
           female_unemployed_16_24+
           Estimate..Female....25.to.54.years....In.labor.force....Civilian....Unemployed+
           Estimate..Female....55.to.64.years....In.labor.force....Civilian....Unemployed+
           Estimate..Female....65.to.69.years....In.labor.force....Unemployed+
           Estimate..Female....70.years.and.over....In.labor.force....Unemployed,
         
         female_in_labor_force_16_24 = 
           Estimate..Male....16.to.19.years....In.labor.force.+
           Estimate..Female....20.to.24.years....In.labor.force.,
         
         female_in_labor_force = female_in_labor_force_16_24+
           Estimate..Female....25.to.54.years....In.labor.force.+
           Estimate..Female....55.to.64.years....In.labor.force.+
           Estimate..Female....65.to.69.years....In.labor.force.+
           Estimate..Female....70.years.and.over....In.labor.force.,
         
         female_unemployment = female_unemployed/female_in_labor_force,
         
         female_unemployment_16_24 = female_unemployed_16_24/female_in_labor_force_16_24,
         
         female_out_of_lf_25_54 = 1-(Estimate..Female....25.to.54.years....In.labor.force./Estimate..Female....25.to.54.years.),
         
         unemployment = (male_unemployed+female_unemployed)/(male_in_labor_force+female_in_labor_force),
         
         unemployment_16_24 = (male_unemployed_16_24+female_unemployed_16_24)/(male_in_labor_force_16_24+female_in_labor_force_16_24))

lville_white_unemployment = 
  white_unemployment_data %>%
  filter(FIPS == 21111)%>%
  select(year, unemployment, male_unemployment, female_unemployment, male_unemployment_16_24, 
         female_unemployment_16_24, male_out_of_lf_25_54,female_out_of_lf_25_54, unemployment_16_24)%>%
  mutate(wh_unemployment = unemployment*100,
         wh_male_unemployment = male_unemployment*100,
         wh_female_unemployment = female_unemployment*100,
         wh_male_unemployment_16_24 = male_unemployment_16_24*100,
         wh_female_unemployment_16_24 = female_unemployment_16_24*100,
         wh_male_out_of_lf_25_54 = male_out_of_lf_25_54*100,
         wh_female_out_of_lf_25_54 = female_out_of_lf_25_54*100,
         wh_unemployment_16_24 = unemployment_16_24*100)

lville_unemployment = full_join(lville_black_unemployment, lville_white_unemployment, by = "year")
lville_unemployment = 
  lville_unemployment %>%
  mutate(unemp_ratio = bl_unemployment/wh_unemployment,
         unemp_ratio_16_24 = bl_unemployment_16_24/wh_unemployment_16_24,
         male_oolf_ratio = bl_male_out_of_lf_25_54/wh_male_out_of_lf_25_54,
         female_oolf_ratio = bl_female_out_of_lf_25_54/wh_female_out_of_lf_25_54)
```

Graph unemployment data
```{r, message=FALSE}
setwd("Images September 2017")
if(!dir.exists("Unemployment")){
  dir.create("Unemployment")
}
setwd("Unemployment")
showtext.auto()

#Unemployment rate in Louisville by race
png("Unemployement Rate.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(lville_unemployment,
              "bl_unemployment",
              "wh_unemployment",
              "Black",
              "White", 
              "Unemployment Rate in Louisville",
              colors = c("orange", "darkblue"),
              y_upper = 30,
              caption_text = "Source: Greater Louisville Project
              Data from the American Community Survey, Tables B23002A and B23002B")
dev.off()

#Male unemployment in Louisville by race
png("Male Unemployment Rate.png", 2700, 1800, res = 300, type = "cairo")
two_var_trend(lville_unemployment, 
              "bl_male_unemployment", 
              "wh_male_unemployment", 
              "Black", 
              "White", 
              "Male Unemployment Rate in Louisville", 
              colors = c("orange", "darkblue"),
              caption_text = "Source: Greater Louisville Project
              Data from the American Community Survey, Tables B23002A and B23002B")
dev.off()

#Female unemployment in Louisville by race
png("Female Unemployment Rate.png", 2700, 1800, res = 300, type = "cairo")
two_var_trend(lville_unemployment, 
              "bl_female_unemployment", 
              "wh_female_unemployment", 
              "Black", 
              "White", 
              "Female Unemployment Rate in Louisville", 
              colors = c("orange", "darkblue"),
              caption_text = "Source: Greater Louisville Project
              Data from the American Community Survey, Tables B23002A and B23002B")
dev.off()

#Unemployment black-white ratio
png("Unemployment Black-White Ratio.png", 2700, 1800, res = 300, type = "cairo")
one_var_trend(lville_unemployment, 
              "unemp_ratio", 
              "Unemployment Black-White Ratio in Louisville",
              color = "orange",
              y_title = "Ratio",
              y_lower = 1,
              y_upper = 3.5,
              caption_text = "Source: Greater Louisville Project
              Data from the American Community Survey, Tables B23002A and B23002B")
dev.off()

#Black out-of-labor force rate in Louisville by gender, 25-54
png("Black Out of Labor Force by Gender.png", 2700, 1800, res = 300, type = "cairo")
two_var_trend(lville_unemployment, 
              "bl_male_out_of_lf_25_54", 
              "bl_female_out_of_lf_25_54", 
              "Male", 
              "Female", 
              "Black Out of Labor Force Rate in Louisville, Ages 24-55",
              caption_text = "Source: Greater Louisville Project
              Data from the American Community Survey, Tables B23002A and B23002B")
dev.off()


#White out-of-labor force rate in Louisville by gender, 25-54
png("White Out of Labor Force by Gender.png", 2700, 1800, res = 300, type = "cairo")
two_var_trend(lville_unemployment, 
              "wh_male_out_of_lf_25_54", 
              "wh_female_out_of_lf_25_54", 
              "Male", 
              "Female", 
              "White Out of Labor Force Rate in Louisville, Ages 24-55",
caption_text = "Source: Greater Louisville Project
              Data from the American Community Survey, Tables B23002A and B23002B")
dev.off()

```

Peer city comparison
```{r, message = FALSE}
setwd("Images September 2017")
if(!dir.exists("Unemployment")){
  dir.create("Unemployment")
}
setwd("Unemployment")
showtext.auto()

peer_black_unemployment = black_unemployment_data %>%
  filter(FIPS != 21111 & current == 1)%>%
  select(FIPS, year, unemployment)%>%
  mutate(bl_unemployment = unemployment*100)

peer_white_unemployment = white_unemployment_data %>%
  filter(FIPS != 21111  & current ==1)%>%
  select(FIPS, year, unemployment)%>%
  mutate(wh_unemployment = unemployment*100)

peer_unemployment = full_join(peer_black_unemployment, peer_white_unemployment, by = c("year", "FIPS"))
peer_unemployment = peer_unemployment %>%
  mutate(peer_unemp_ratio = bl_unemployment/wh_unemployment)%>%
  select(FIPS, year, bl_unemployment, peer_unemp_ratio)
  
stl_data = stl_wgt(peer_unemployment, "peer_unemp_ratio")
stl_data = cbind(stl_data$peer_unemp_ratio, stl_wgt(peer_unemployment, "bl_unemployment"))%>%
  mutate(peer_unemp_ratio = stl_data$peer_unemp_ratio)%>%
  select(FIPS, year, peer_unemp_ratio, bl_unemployment)

peer_unemployment = rbind(peer_unemployment, stl_data)
peer_unemployment = peer_unemployment %>%
  filter(FIPS != 29189 & FIPS != 29510)

peer_avg = peer_unemployment %>%
  group_by(year) %>%
  summarise(bl_unemployment = mean(bl_unemployment, na.rm=TRUE), unemp_ratio = mean(peer_unemp_ratio, na.rm = TRUE))
  
lville_unemp = lville_unemployment %>%
  select(year, lv_unemp_ratio = unemp_ratio, lv_bl_unemployment = bl_unemployment)
peer_and_lville = full_join(peer_avg, lville_unemp, by = "year")

#Black unemployment in Louisville and peer cities
png("Black Unemployment, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(peer_and_lville, 
              "lv_bl_unemployment", 
              "bl_unemployment", 
              "Louisville", 
              "Peer City Mean", 
              "Black Unemployment in Louisville and Peer Cities",
              y_title = "Ratio", 
              colors = c("purple", "limegreen"), 
              caption_text = "Source: Greater Louisville Project
              Data from American Community Survey Tables B23002A and B23002B")
dev.off()

#Unemployment black/-hite ratio in Louisville and peer cities
png("Unemployment Ratio, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(peer_and_lville, 
              "lv_unemp_ratio", 
              "unemp_ratio", 
              "Louisville", 
              "Peer City Mean", 
              "Black-White Unemployment Ratio in Louisville and Peer Cities",
              y_title = "Ratio", 
              colors = c("purple", "limegreen"), 
              y_lower = 1, 
              y_upper = 3.5,
              caption_text = "Source: Greater Louisville Project
              Data from American Community Survey Tables B23002A and B23002B")
dev.off()
```


EDUCATION

Read in data for black educational attainment
```{r, message=FALSE}
#BLACK
black_educ_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Education/Black",
                           starting.year = 2008)

black_educ_data = black_educ_data %>%
  mutate(male_hs_higher_num = 
           Estimate..Male....Regular.high.school.diploma+
           Estimate..Male....GED.or.alternative.credential+
           Estimate..Male....Some.college..no.degree+
           Estimate..Male....Associate.s.degree+
           Estimate..Male....Bachelor.s.degree+
           Estimate..Male....Graduate.degree,
         
         male_associate_higher_num = 
           Estimate..Male....Associate.s.degree+
           Estimate..Male....Bachelor.s.degree+
           Estimate..Male....Graduate.degree,
         
         male_bachelors_higher_num = 
           Estimate..Male....Bachelor.s.degree+
           Estimate..Male....Graduate.degree,
         
         m_hs_higher_pct = male_hs_higher_num/Estimate..Male.,
         
         m_assoc_higher_pct = male_associate_higher_num/Estimate..Male.,
         
         m_bach_higher_pct = male_bachelors_higher_num/Estimate..Male.,
         
         m_no_hs_pct = 
           (Estimate..Male....Less.than.9th.grade+
            Estimate..Male....9th.to.12th.grade..no.diploma)
           /Estimate..Male.,
         
         m_hs_pct = 
           (Estimate..Male....Regular.high.school.diploma+
            Estimate..Male....GED.or.alternative.credential)
           /Estimate..Male.,
         
         m_some_pct = Estimate..Male....Some.college..no.degree/Estimate..Male.,
         
         m_assoc_pct = Estimate..Male....Associate.s.degree/Estimate..Male.,
         
         m_bach_pct = Estimate..Male....Bachelor.s.degree/Estimate..Male.,
         
         m_grad_pct = Estimate..Male....Graduate.degree/Estimate..Male.,
         
         female_hs_higher_num = 
           Estimate..Female....Regular.high.school.diploma+
           Estimate..Female....GED.or.alternative.credential+
           Estimate..Female....Some.college..no.degree+
           Estimate..Female....Associate.s.degree+
           Estimate..Female....Bachelor.s.degree+
           Estimate..Female....Graduate.degree,
         
         female_associate_higher_num = 
           Estimate..Female....Associate.s.degree+
           Estimate..Female....Bachelor.s.degree+
           Estimate..Female....Graduate.degree,
         
         female_bachelors_higher_num = 
           Estimate..Female....Bachelor.s.degree+
           Estimate..Female....Graduate.degree,
         
         f_hs_higher_pct = female_hs_higher_num/Estimate..Female.,
         
         f_assoc_higher_pct = female_associate_higher_num/Estimate..Female.,
         
         f_bach_higher_pct = female_bachelors_higher_num/Estimate..Female.,
         
         f_no_hs_pct = 
           (Estimate..Female....Less.than.9th.grade+
            Estimate..Female....9th.to.12th.grade..no.diploma)
           /Estimate..Female.,
         
         f_hs_pct = 
           (Estimate..Female....Regular.high.school.diploma+
            Estimate..Female....GED.or.alternative.credential)
           /Estimate..Female.,
         
         f_some_pct = Estimate..Female....Some.college..no.degree/Estimate..Female.,
         
         f_assoc_pct = Estimate..Female....Associate.s.degree/Estimate..Female.,
         
         f_bach_pct = Estimate..Female....Bachelor.s.degree/Estimate..Female.,
         
         f_grad_pct = Estimate..Female....Graduate.degree/Estimate..Female.,
         
         hs_higher_pct = (male_hs_higher_num+female_hs_higher_num)/Estimate..Total.,
         
         assoc_higher_pct = (male_associate_higher_num+female_associate_higher_num)/Estimate..Total.,
         
         bach_higher_pct = (male_bachelors_higher_num+female_bachelors_higher_num)/Estimate..Total.)

lville_black_educ = black_educ_data %>%
  filter(FIPS == 21111)%>%
  select(year, 
         m_hs_higher_pct, m_assoc_higher_pct, m_bach_higher_pct, m_no_hs_pct, m_hs_pct, m_some_pct, m_assoc_pct,
         m_bach_pct, m_grad_pct,
         f_hs_higher_pct, f_assoc_higher_pct, f_bach_higher_pct, f_no_hs_pct, f_hs_pct, f_some_pct, f_assoc_pct,
         f_bach_pct, f_grad_pct,
         hs_higher_pct, assoc_higher_pct, bach_higher_pct)

lville_black_educ[,2:22]=lville_black_educ[,2:22]*100

#WHITE
white_educ_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Education/White",
                           starting.year = 2008)

white_educ_data = white_educ_data %>%
  mutate(male_hs_higher_num = Estimate..Male....Regular.high.school.diploma+
           Estimate..Male....GED.or.alternative.credential+
           Estimate..Male....Some.college..no.degree+
           Estimate..Male....Associate.s.degree+
           Estimate..Male....Bachelor.s.degree+
           Estimate..Male....Graduate.degree,
         male_associate_higher_num = Estimate..Male....Associate.s.degree+
           Estimate..Male....Bachelor.s.degree+
           Estimate..Male....Graduate.degree,
         male_bachelors_higher_num = Estimate..Male....Bachelor.s.degree+
           Estimate..Male....Graduate.degree,
         m_hs_higher_pct = male_hs_higher_num/Estimate..Male.,
         m_assoc_higher_pct = male_associate_higher_num/Estimate..Male.,
         m_bach_higher_pct = male_bachelors_higher_num/Estimate..Male.,
         m_no_hs_pct = (Estimate..Male....Less.than.9th.grade+
                          Estimate..Male....9th.to.12th.grade..no.diploma)/Estimate..Male.,
         m_hs_pct = (Estimate..Male....Regular.high.school.diploma+
                       Estimate..Male....GED.or.alternative.credential)/Estimate..Male.,
         m_some_pct = Estimate..Male....Some.college..no.degree/Estimate..Male.,
         m_assoc_pct = Estimate..Male....Associate.s.degree/Estimate..Male.,
         m_bach_pct = Estimate..Male....Bachelor.s.degree/Estimate..Male.,
         m_grad_pct = Estimate..Male....Graduate.degree/Estimate..Male.,
         
         female_hs_higher_num = Estimate..Female....Regular.high.school.diploma+
           Estimate..Female....GED.or.alternative.credential+
           Estimate..Female....Some.college..no.degree+
           Estimate..Female....Associate.s.degree+
           Estimate..Female....Bachelor.s.degree+
           Estimate..Female....Graduate.degree,
         female_associate_higher_num = Estimate..Female....Associate.s.degree+
           Estimate..Female....Bachelor.s.degree+
           Estimate..Female....Graduate.degree,
         female_bachelors_higher_num = Estimate..Female....Bachelor.s.degree+
           Estimate..Female....Graduate.degree,
         f_hs_higher_pct = female_hs_higher_num/Estimate..Female.,
         f_assoc_higher_pct = female_associate_higher_num/Estimate..Female.,
         f_bach_higher_pct = female_bachelors_higher_num/Estimate..Female.,
         f_no_hs_pct = (Estimate..Female....Less.than.9th.grade+
                          Estimate..Female....9th.to.12th.grade..no.diploma)/Estimate..Female.,
         f_hs_pct = (Estimate..Female....Regular.high.school.diploma+
                       Estimate..Female....GED.or.alternative.credential)/Estimate..Female.,
         f_some_pct = Estimate..Female....Some.college..no.degree/Estimate..Female.,
         f_assoc_pct = Estimate..Female....Associate.s.degree/Estimate..Female.,
         f_bach_pct = Estimate..Female....Bachelor.s.degree/Estimate..Female.,
         f_grad_pct = Estimate..Female....Graduate.degree/Estimate..Female.,
         
         hs_higher_pct = (male_hs_higher_num+female_hs_higher_num)/Estimate..Total.,
         assoc_higher_pct = (male_associate_higher_num+female_associate_higher_num)/Estimate..Total.,
         bach_higher_pct = (male_bachelors_higher_num+female_bachelors_higher_num)/Estimate..Total.)

lville_white_educ = white_educ_data %>%
  filter(FIPS == 21111)%>%
  select(year, m_hs_higher_pct, m_assoc_higher_pct, m_bach_higher_pct, m_no_hs_pct, m_hs_pct, m_some_pct, m_assoc_pct,
         m_bach_pct, m_grad_pct,
         f_hs_higher_pct, f_assoc_higher_pct, f_bach_higher_pct, f_no_hs_pct, f_hs_pct, f_some_pct, f_assoc_pct,
         f_bach_pct, f_grad_pct,
         hs_higher_pct, assoc_higher_pct, bach_higher_pct)

lville_white_educ[,2:22]=lville_white_educ[,2:22]*100
```

Create histogram plot
```{r}
setwd("Images September 2017")
if(!dir.exists("Education")){
  dir.create("Education")
}
setwd("Education")
showtext.auto()

lville_bl_ed_hist = lville_black_educ %>%
  filter(year >=2011)

attach(lville_bl_ed_hist)
lville_bl_m_educ = c(mean(m_no_hs_pct),mean(m_hs_pct), mean(m_some_pct), mean(m_assoc_pct), mean(m_bach_pct), mean(m_grad_pct))
lville_bl_f_educ = c(mean(f_no_hs_pct),mean(f_hs_pct), mean(f_some_pct), mean(f_assoc_pct), mean(f_bach_pct), mean(f_grad_pct))
detach(lville_bl_ed_hist)

lville_wh_ed_hist = lville_white_educ %>%
  filter(year >=2011)

attach(lville_wh_ed_hist)
lville_wh_m_educ = c(mean(m_no_hs_pct),mean(m_hs_pct), mean(m_some_pct), mean(m_assoc_pct), mean(m_bach_pct), mean(m_grad_pct))
lville_wh_f_educ = c(mean(f_no_hs_pct),mean(f_hs_pct), mean(f_some_pct), mean(f_assoc_pct), mean(f_bach_pct), mean(f_grad_pct))
detach(lville_wh_ed_hist)
educ_names = c("No HS", "HS", "Some College", "Associate's", "Bachelor's", "Graduate", 
               "No HS", "HS", "Some College", "Associate's", "Bachelor's", "Graduate",
               "No HS", "HS", "Some College", "Associate's", "Bachelor's", "Graduate",
               "No HS", "HS", "Some College", "Associate's", "Bachelor's", "Graduate")
gender = c("Black Male", "Black Male", "Black Male", "Black Male", "Black Male", "Black Male", 
           "Black Female", "Black Female", "Black Female", "Black Female", "Black Female", "Black Female",
           "White Male", "White Male", "White Male", "White Male", "White Male", "White Male", 
           "White Female", "White Female", "White Female", "White Female", "White Female", "White Female")
percent = c(lville_bl_m_educ, lville_bl_f_educ, lville_wh_m_educ, lville_wh_f_educ)

lville_ed_hist = data.frame(educ_names, gender, percent)

##setting factor levels
lville_ed_hist$educ_names = factor(lville_ed_hist$educ_names, levels = c(
  "No HS", "HS", "Some College", "Associate's","Bachelor's","Graduate"))


#Histogram
educ_hist = 
  ggplot(lville_ed_hist, 
         aes(x=educ_names, y=percent)) +
  geom_bar(stat="identity")+
  facet_wrap(~gender)

educ_hist = educ_hist + theme_bw()

educ_hist = educ_hist +
  labs(title = "Educational Attainment in Lousville by Race and Gender, 2011-2015", 
       y="Percent", 
       x = "Highest Level of Education",
       caption = "Source: Greater Louisville Project 
                Data from the American Community Survey, Tables B15002A and B15002B")

educ_hist = educ_hist+
  theme(axis.text.x=element_text(angle=30, 
                                 vjust=0.5,
                                 family = "Museo Sans 300", 
                                 face = "bold",
                                 size = 36))+
  theme(plot.title = element_text(family = "Museo Sans 300", 
                                  hjust = 0.5,
                                  size = 54,
                                  margin = margin(t=10,b=10)))+
  theme(axis.text = element_text(family = "Museo Sans 300",
                                 size = 36))+
  theme(axis.title.x = element_text(margin = margin(t=10)))+
  theme(axis.title = element_text(family = "Museo Sans 300",
                                  size = 48))+
  theme(strip.text = element_text(family = "Museo Sans 300",
                                  size = 48))+
  theme(plot.caption = element_text(family = "Museo Sans 300",
                                    size = 24,
                                    lineheight = .3))


png(filename = "Educational Attainment Histogram.png", width = 2700, height = 2700, res=300, type = "cairo")
educ_hist
dev.off()

showtext.auto(FALSE)
```


INCOME

Read in black and white income data
```{r, message = FALSE}
black_income_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Income/Black")

black_income_data = black_income_data %>% 
  select(bl_m_income = Estimate..Male......Total,
         bl_ft_m_income = Estimate..Male......Worked.full.time..year.round.in.the.past.12.months,
         bl_f_income = Estimate..Female......Total,
         bl_ft_f_income = Estimate..Female......Worked.full.time..year.round.in.the.past.12.months,
         FIPS, year) %>%
  mutate(bl_m_income = as.numeric(as.character(bl_m_income)),
         bl_ft_m_income = as.numeric(as.character(bl_ft_m_income)),
         bl_f_income = as.numeric(as.character(bl_f_income)),
         bl_ft_f_income = as.numeric(as.character(bl_ft_f_income)))

white_income_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Income/White")

white_income_data = white_income_data %>% 
  select(wh_m_income = Estimate..Male......Total,
         wh_ft_m_income = Estimate..Male......Worked.full.time..year.round.in.the.past.12.months,
         wh_f_income = Estimate..Female......Total,
         wh_ft_f_income = Estimate..Female......Worked.full.time..year.round.in.the.past.12.months,
         FIPS, year) %>%
  mutate(wh_m_income = as.numeric(wh_m_income),
         wh_ft_m_income = as.numeric(wh_ft_m_income),
         wh_f_income = as.numeric(wh_f_income),
         wh_ft_f_income = as.numeric(wh_ft_f_income))

l_black_income_data = black_income_data %>%
  filter(FIPS == 21111)

l_white_income_data = white_income_data %>%
  filter(FIPS == 21111)

lville_income_data = full_join(l_black_income_data, l_white_income_data, by = "year")
```

Graph income data
```{r, message = FALSE}
setwd("Images September 2017")
if(!dir.exists("Income")){
  dir.create("Income")
}
setwd("Income")
showtext.auto()

#median female earnings by race
png("Median Female Earnings in Louisville.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(lville_income_data, 
              "bl_f_income", 
              "wh_f_income", 
              "Black", 
              "White", 
              "Median Female Earnings in Louisville", 
              y_title = "Dollars",
              colors = c("orange", "darkblue"), 
              y_lower = 0, 
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#median male earnings by race
png("Median Male Earnings in Louisville.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(lville_income_data, 
              "bl_m_income",
              "wh_m_income",
              "Black", 
              "White", 
              "Median Male Earnings in Louisville", 
              y_title = "Dollars",
              colors = c("orange", "darkblue"), 
              y_lower = 0, 
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#median female earnings for full-time, year-round workers by race
png("Median Female Earnings in Louisville for full-time, year-round workers.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(lville_income_data, 
              "bl_ft_f_income", 
              "wh_ft_f_income", 
              "Black", 
              "White", 
              "Median Female Earnings for Full-Time, Year-Round\nWorkers in Louisville", 
              y_title = "Dollars",
              colors = c("orange", "darkblue"), 
              y_lower = 0,
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#median male earnings for full-time, year-round workers by race
png("Median Male Earnings in Louisville for full-time, year-round workers.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(lville_income_data, 
              "bl_ft_m_income",
              "wh_ft_m_income", 
              "Black", 
              "White", 
              "Median Male Earnings for Full-Time, Year-Round\nWorkers in Louisville", 
              y_title = "Dollars",
              colors = c("orange", "darkblue"), 
              y_lower = 0,
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()
```

Peer city comparison
```{r, message = FALSE}
setwd("Images September 2017")
if(!dir.exists("Income")){
  dir.create("Income")
}
setwd("Income")
showtext.auto()

income_data = full_join(black_income_data, white_income_data, by = c("year", "FIPS"))
income_data = income_data %>% 
  filter(FIPS != 21111)
 
stl_bl_m = stl_wgt(income_data, "bl_m_income")
stl_bl_ft_m = stl_wgt(income_data, "bl_ft_m_income")
stl_bl_f = stl_wgt(income_data, "bl_f_income")
stl_bl_ft_f = stl_wgt(income_data, "bl_ft_f_income")
stl_wh_m = stl_wgt(income_data, "wh_m_income")
stl_wh_ft_m = stl_wgt(income_data, "wh_ft_m_income")
stl_wh_f = stl_wgt(income_data, "wh_f_income")
stl_wh_ft_f = stl_wgt(income_data, "wh_ft_f_income")

stl_inc = full_join(stl_bl_m, stl_bl_ft_m, by= c("FIPS", "year", "current"))
stl_inc = full_join(stl_inc, stl_bl_f, by = c("FIPS", "year", "current"))
stl_inc = full_join(stl_inc, stl_bl_ft_f, by = c("FIPS", "year", "current"))
stl_inc = full_join(stl_inc, stl_wh_m, by = c("FIPS", "year", "current"))
stl_inc = full_join(stl_inc, stl_wh_ft_m, by = c("FIPS", "year", "current"))
stl_inc = full_join(stl_inc, stl_wh_f, by = c("FIPS", "year", "current"))
stl_inc = full_join(stl_inc, stl_wh_ft_f, by = c("FIPS", "year", "current"))

stl_inc = stl_inc %>%
  select(-current)

income_data = income_data[c("FIPS", "year", "bl_m_income", "bl_ft_m_income", "bl_f_income", "bl_ft_f_income",
                            "wh_m_income", "wh_ft_m_income","wh_f_income","wh_ft_f_income")]#reordering

names(income_data)==names(stl_inc)##testing that dataframes are lined up
peer_inc_data = rbind(income_data, stl_inc)

pm_inc_data = peer_inc_data %>%
  group_by(year) %>%
  summarize(
    p_bl_m_income = mean(bl_m_income, na.rm=TRUE),
    p_bl_ft_m_income = mean(bl_ft_m_income, na.rm=TRUE),
    p_bl_f_income = mean(bl_f_income, na.rm=TRUE),
    p_bl_ft_f_income = mean(bl_ft_f_income, na.rm=TRUE),
    p_wh_m_income = mean(wh_m_income, na.rm=TRUE),
    p_wh_ft_m_income = mean(wh_ft_m_income, na.rm=TRUE),
    p_wh_f_income = mean(wh_f_income, na.rm=TRUE),
    p_wh_ft_f_income = mean(wh_ft_f_income, na.rm=TRUE)
  )


l_and_pm_inc = full_join(lville_income_data, pm_inc_data, by = "year")

l_and_pm_inc = l_and_pm_inc %>%
  mutate(
    l_m_income_gap = wh_m_income - bl_m_income,
    l_ft_m_income_gap = wh_ft_m_income - bl_ft_m_income,
    l_f_income_gap = wh_f_income - bl_f_income,
    l_ft_f_income_gap = wh_ft_f_income - bl_ft_f_income,
    p_m_income_gap = p_wh_m_income - p_bl_m_income,
    p_ft_m_income_gap = p_wh_ft_m_income - p_bl_ft_m_income,
    p_f_income_gap = p_wh_f_income - p_bl_f_income,
    p_ft_f_income_gap = p_wh_ft_f_income - p_bl_ft_f_income
  )

#Median income for black females vs. peer cites
png("Median Income for Black Females, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "bl_f_income", 
              "p_bl_f_income", 
              "Louisivlle", 
              "Peer City Mean", 
              "Median Income for Black Females\nin Louisville and Peer Cities", 
              y_title = "Dollars",
              colors = c("purple", "limegreen"), 
              y_lower = 0, 
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#Median income for black males vs. peer cites
png("Median Income for Black Males, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "bl_m_income", 
              "p_bl_m_income", 
              "Louisivlle", 
              "Peer City Mean", 
              "Median Income for Black Males\nin Louisville and Peer Cities", 
              y_title = "Dollars",
              colors = c("purple", "limegreen"), 
              y_lower = 0, 
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#Median income for black females working full-time, year-round vs. peer cites
png("Median Income for Black Females Working Year-round, Full-time, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "bl_ft_f_income", 
              "p_bl_ft_f_income",
              "Louisivlle", 
              "Peer City Mean", 
              "Median Income for Black Females Working Full-Time, Year-Round\nin Louisville and Peer Cities", 
              y_title = "Dollars",
              colors = c("purple", "limegreen"),
              y_lower = 0,
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#Median income for black males working full-time, year-round vs. peer cites
png("Median Income for Black Males Working Year-round, Full-time, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "bl_ft_m_income",
              "p_bl_ft_m_income", 
              "Louisivlle", 
              "Peer City Mean", 
              "Median Income for Black Males Working Full-Time, Year-Round\nin Louisville and Peer Cities", 
              y_title = "Dollars",
              colors = c("purple", "limegreen"),
              y_lower = 0, 
              y_upper = 60000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#Difference in median income bewteen white and black females
png("Difference in Median Income between White and Black Females, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "l_f_income_gap",
              "p_f_income_gap", 
              "Louisivlle", 
              "Peer City Mean", 
              "Difference in Median Income between White and Black Females\nin Louisville and Peer Cities",
              y_title = "Dollars",
              colors = c("purple", "limegreen"), 
              y_lower = 0, 
              y_upper = 30000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#Difference in median income bewteen white and black males
png("Difference in Median Income between White and Black Males, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "l_m_income_gap", 
              "p_m_income_gap", 
              "Louisivlle", 
              "Peer City Mean", 
              "Difference in Median Income between White and Black Males\nin Louisville and Peer Cities",
              y_title = "Dollars",
              colors = c("purple", "limegreen"), 
              y_lower = 0, 
              y_upper = 30000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#Difference in median income bewteen white and black females, fill-time, year-round
png("Difference in Median Income between White and Black Females Working Year-round, Full-time, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "l_ft_f_income_gap", 
              "p_ft_f_income_gap", 
              "Louisivlle", 
              "Peer City Mean", 
              "Difference in Median Income between White and Black Females\nWorking Full-Time, Year-Round in Louisville and Peer Cities", 
              y_title = "Dollars",
              colors = c("purple", "limegreen"), 
              y_lower = 0, 
              y_upper = 30000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()

#Difference in median income bewteen white and black males, full-time, year-round
png("Difference in Median Income between White and Black Males Working Year-round, Full-time, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_inc, 
              "l_ft_m_income_gap", 
              "p_ft_m_income_gap", 
              "Louisivlle", 
              "Peer City Mean", 
              "Difference in Median Income between White and Black Males\nWorking Full-Time, Year-Round in Louisville and Peer Cities", 
              y_title = "Dollars",
              colors = c("purple", "limegreen"), 
              y_lower = 0, 
              y_upper = 30000,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B20017A and B200172B")
dev.off()
```


POVERTY

Read in poverty data
```{r}
#BLACK
black_pov_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Poverty/Black")

black_pov_data = black_pov_data %>%
  mutate(num_m_child_poor = Estimate..Income.in.the.past.12.months.below.poverty.level....Male....Under.5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....12.to.14.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....6.to.11.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....15.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....16.and.17.years,
         num_f_child_poor = Estimate..Income.in.the.past.12.months.below.poverty.level....Female....Under.5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....6.to.11.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....12.to.14.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....15.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....16.and.17.years,
         num_m_child_not_poor = Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....Under.5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....6.to.11.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....12.to.14.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....15.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....16.and.17.years,
         num_f_child_not_poor = Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....Under.5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....6.to.11.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....12.to.14.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....15.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....16.and.17.years,
         child_pov = (num_m_child_poor+num_f_child_poor)/(num_m_child_poor+num_m_child_not_poor+
                                                            num_f_child_poor+num_f_child_not_poor),
         pov = Estimate..Income.in.the.past.12.months.below.poverty.level./Estimate..Total.,
         m_pov = Estimate..Income.in.the.past.12.months.below.poverty.level....Male./
           (Estimate..Income.in.the.past.12.months.below.poverty.level....Male. + 
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male.),
         f_pov = Estimate..Income.in.the.past.12.months.below.poverty.level....Female./
           (Estimate..Income.in.the.past.12.months.below.poverty.level....Female.+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female.)
          )

black_pov_data = black_pov_data %>%
  mutate(child_pov = child_pov*100,
         m_pov = m_pov*100,
         f_pov = f_pov*100,
         pov = pov*100) %>%
  select(FIPS, year, bl_child_pov = child_pov, bl_m_pov = m_pov, bl_f_pov = f_pov, bl_pov = pov)

#WHITE
white_pov_data = acs_time("C:/Users/Harrison Kirby/Desktop/GLP/State of Black Lville/input data/Poverty/White")

white_pov_data = white_pov_data %>%
  mutate(num_m_child_poor = Estimate..Income.in.the.past.12.months.below.poverty.level....Male....Under.5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....12.to.14.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....6.to.11.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....15.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Male....16.and.17.years,
         num_f_child_poor = Estimate..Income.in.the.past.12.months.below.poverty.level....Female....Under.5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....5.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....6.to.11.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....12.to.14.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....15.years+
           Estimate..Income.in.the.past.12.months.below.poverty.level....Female....16.and.17.years,
         num_m_child_not_poor = Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....Under.5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....6.to.11.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....12.to.14.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....15.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male....16.and.17.years,
         num_f_child_not_poor = Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....Under.5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....5.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....6.to.11.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....12.to.14.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....15.years+
           Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female....16.and.17.years,
         child_pov = (num_m_child_poor+num_f_child_poor)/(num_m_child_poor+num_m_child_not_poor+
                                                            num_f_child_poor+num_f_child_not_poor),
         pov = Estimate..Income.in.the.past.12.months.below.poverty.level./Estimate..Total.,
         m_pov = Estimate..Income.in.the.past.12.months.below.poverty.level....Male./
           (Estimate..Income.in.the.past.12.months.below.poverty.level....Male. + 
              Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Male.),
         f_pov = Estimate..Income.in.the.past.12.months.below.poverty.level....Female./
           (Estimate..Income.in.the.past.12.months.below.poverty.level....Female.+
              Estimate..Income.in.the.past.12.months.at.or.above.poverty.level....Female.)
  )

white_pov_data = white_pov_data %>%
  mutate(child_pov = child_pov*100,
         m_pov = m_pov*100,
         f_pov = f_pov*100,
         pov = pov*100) %>%
  select(FIPS, year, wh_child_pov = child_pov, wh_m_pov = m_pov, wh_f_pov = f_pov, wh_pov = pov)

pov_data = full_join(black_pov_data, white_pov_data, by=c("FIPS", "year"))

l_pov_data = pov_data %>%
  filter(FIPS == 21111)
```

Graph poverty data
```{r}
setwd("Images September 2017")
if(!dir.exists("Poverty")){
  dir.create("Poverty")
}
setwd("Poverty")
showtext.auto()

#Poverty Rate in Louisville
png("Poverty Rate in Louisville.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_pov_data, 
              "bl_pov",
              "wh_pov", 
              "Black", 
              "White", 
              "Poverty Rate in Louisville",
              colors = c("orange", "darkblue"), 
              y_upper = 65,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B17001A and B17001B")
dev.off()

#Child Poverty Rate in Louisville
png("Child Poverty Rate in Louisville.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_pov_data, 
              "bl_child_pov", 
              "wh_child_pov", 
              "Black", 
              "White", 
              "Child Poverty Rate in Louisville",
              colors = c("orange", "darkblue"), 
              y_upper = 65,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B17001A and B17001B")
dev.off()

```

Peer city comparison
```{r}
setwd("Images September 2017")
if(!dir.exists("Poverty")){
  dir.create("Poverty")
}
setwd("Poverty")
showtext.auto()

p_pov_data = pov_data %>% 
  filter(FIPS != 21111)

stl_bl_child_pov = stl_wgt(p_pov_data, "bl_child_pov")
stl_bl_pov = stl_wgt(p_pov_data, "bl_pov")
stl_bl_f_pov = stl_wgt(p_pov_data, "bl_f_pov")
stl_bl_m_pov = stl_wgt(p_pov_data, "bl_m_pov")
stl_wh_child_pov = stl_wgt(p_pov_data, "wh_child_pov")
stl_wh_pov = stl_wgt(p_pov_data, "wh_pov")
stl_wh_f_pov = stl_wgt(p_pov_data, "wh_f_pov")
stl_wh_m_pov = stl_wgt(p_pov_data, "wh_m_pov")


stl_pov = full_join(stl_bl_child_pov, stl_bl_pov, by= c("FIPS", "year", "current"))
stl_pov = full_join(stl_pov, stl_bl_f_pov, by= c("FIPS", "year", "current"))
stl_pov = full_join(stl_pov, stl_bl_m_pov, by= c("FIPS", "year", "current"))
stl_pov = full_join(stl_pov, stl_wh_child_pov, by= c("FIPS", "year", "current"))
stl_pov = full_join(stl_pov, stl_wh_pov, by= c("FIPS", "year", "current"))
stl_pov = full_join(stl_pov, stl_wh_f_pov, by= c("FIPS", "year", "current"))
stl_pov = full_join(stl_pov, stl_wh_m_pov, by= c("FIPS", "year", "current"))

stl_pov = stl_pov %>%
  select(-current)

stl_pov = stl_pov[c("FIPS", "year", "bl_child_pov", "bl_m_pov", "bl_f_pov", "bl_pov",
                            "wh_child_pov", "wh_m_pov","wh_f_pov","wh_pov")]#reordering

names(stl_pov) == names(p_pov_data)

peer_pov_data = rbind(p_pov_data, stl_pov)

pm_pov_data = peer_pov_data %>%
  group_by(year) %>%
  summarize(
    p_bl_m_pov = mean(bl_m_pov, na.rm=TRUE),
    p_bl_child_pov = mean(bl_child_pov, na.rm=TRUE),
    p_bl_f_pov = mean(bl_f_pov, na.rm=TRUE),
    p_bl_pov = mean(bl_pov, na.rm=TRUE),
    p_wh_m_pov = mean(wh_m_pov, na.rm=TRUE),
    p_wh_child_pov = mean(wh_child_pov, na.rm=TRUE),
    p_wh_f_pov = mean(wh_f_pov, na.rm=TRUE),
    p_wh_pov = mean(wh_pov, na.rm=TRUE)
  )


l_and_pm_pov = full_join(l_pov_data, pm_pov_data, by="year")

l_and_pm_pov = l_and_pm_pov %>%
  mutate(
    p_pov_gap = p_bl_pov - p_wh_pov,
    l_pov_gap = bl_pov - wh_pov,
    p_child_pov_gap = p_bl_child_pov - p_wh_child_pov,
    l_child_pov_gap = bl_child_pov - wh_child_pov
  )

#Black Poverty Rate
png("Black Poverty Rate, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_pov, 
              "bl_pov",
              "p_bl_pov", 
              "Louisville", 
              "Peer City Mean", 
              "Black Poverty Rate in Louisville and Peer Cities",
              colors = c("purple", "limegreen"), 
              y_upper = 65,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B17001A and B17001B")
dev.off()

#Child Black Poverty Rate
png("Black Child Poverty Rate, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_pov, 
              "bl_child_pov", 
              "p_bl_child_pov", 
              "Louisville", 
              "Peer City Mean", 
              "Black Child Poverty Rate in Louisville and Peer Cities",
              colors = c("purple", "limegreen"), 
              y_upper = 65,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B17001A and B17001B")
dev.off()

#Black-White Poverty Gap
png("Black-White Poverty Gap, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_pov, 
              "l_pov_gap",
              "p_pov_gap",
              "Louisville",
              "Peer City Mean",
              "Black-White Poverty Gap in Louisville and Peer Cities", 
              y_title = "Percentage Points", 
              colors = c("purple", "limegreen"), 
              y_upper = 65,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B17001A and B17001B")
dev.off()

#Child Black-white poverty Gap
png("Black-White Child Poverty Gap, Peer Cities.png", 2700, 1800, res = 300, type="cairo")
two_var_trend(l_and_pm_pov, 
              "l_child_pov_gap", 
              "p_child_pov_gap", 
              "Louisville", 
              "Peer City Mean", 
              "Black-White Child Poverty Gap in Louisville and Peer Cities", 
              y_title = "Percentage Points", 
              colors = c("purple", "limegreen"), 
              y_upper = 65,
              caption_text = "Source: Greater Louisville Project 
              Data from the American Community Survey, Tables B17001A and B17001B")
dev.off()

```


EXPORT FILES
```{r}
zip(zipfile = "Graphs", files = "Images September 2017")

```